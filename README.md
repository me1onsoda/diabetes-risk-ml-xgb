````markdown
# Diabetes Risk Analysis with XGBoost (Diet-Based)

식습관 데이터를 기반으로 당뇨(전당뇨 및 고혈당) 위험도를 예측하고, 이를 100점 만점의 '식단 건강 점수'로 환산해주는 머신러닝 프로젝트입니다.

##  프로젝트 개요
이 프로젝트는 단순히 혈당 수치를 예측하는 것을 넘어, **"내가 먹은 식단이 혈당 건강에 얼마나 위험한가?"**를 분석하는 데 초점을 맞춥니다.
국민건강영양조사(KNHANES) 데이터를 활용하여 학습되었으며, **XGBoost의 단조 제약 조건(Monotonic Constraints)**을 적용하여 영양학적 상식(예: 당류 섭취가 늘면 위험도가 증가함)과 모델의 예측 결과가 모순되지 않도록 설계되었습니다.

##  주요 기능

### 1. 데이터 전처리 및 필터링
* **데이터 소스**: 국민건강영양조사 2020~2023년 데이터 (`hn20_all` ~ `hn23_all`)
* **대상 필터링**:
    * 만 19세 이상 성인
    * **기진단자 제외**: 이미 당뇨를 진단받은 환자를 제외하고, 식습관으로 인해 혈당이 높아질 위험이 있는 '잠재적 위험군'을 타겟팅합니다.
* **파생 변수 생성**:
    * 칼로리/나트륨/단백질 권장량 충족률
    * 탄수화물 내 당류 비율, 총 칼로리 내 지방 비율 등

### 2. XGBoost 모델링 (With Constraints)
영양 성분이 혈당에 미치는 영향을 논리적으로 반영하기 위해 `monotone_constraints`를 적용했습니다.
* **위험 증가 요인 (+)**: 나이, BMI, 칼로리, 나트륨, 당류, 지방, 탄수화물
* **위험 감소 요인 (-)**: 단백질 (근손실 방지 및 혈당 완충 효과 고려)
* **Target**: 공복혈당 100mg/dL 이상 (전당뇨 및 당뇨 단계)

### 3. 상대평가 스코어링 시스템 (Fair Diet Score)
단순한 확률(Probability) 출력이 아닌, 일반인 기준의 상대적 점수를 제공합니다.
* **Avatar Comparison**: 52세 남성(BMI 26)을 기준으로 가상의 '아바타'를 생성하여, 내 식단이 이 아바타에게 적용되었을 때의 위험도를 산출합니다.
* **Scoring**: 전체 데이터 분포를 기반으로 0~100점 사이의 점수로 변환합니다.
    * **80점 이상**: 매우 훌륭함 (안심)
    * **50~80점**: 주의 필요 (개선 권장)
    * **50점 미만**: 위험 (경고)

## 🛠 설치 및 실행 방법

### 요구 사항 (Requirements)
```bash
pip install pandas numpy xgboost scikit-learn joblib
````

### 실행

1.  프로젝트 폴더에 국민건강영양조사 데이터 파일(`.sas7bdat`)을 위치시킵니다.
      * `hn23_all.sas7bdat`, `hn22_all.sas7bdat`, ...
2.  스크립트를 실행합니다.

<!-- end list -->

```bash
python texct_scoreing.py
```

## 시뮬레이션 결과 예시

코드 내 포함된 페르소나별 시뮬레이션 결과입니다.

| 사용자 케이스 | 식단 특징 | 예상 점수 구간 | 결과 해석 |
| :--- | :--- | :--- | :--- |
| **User A (샐러드)** | 저염, 고단백, 저당 | **높음 (80+)** | "완벽합니다\! 대사질환 걱정 없음" |
| **User B (마라탕)** | 고나트륨, 고당류, 고지방 | **낮음 (\<50)** | "경고\! 혈당 위험군과 매우 유사" |
| **User C (김치찌개)** | 고나트륨, 고탄수화물 | **주의 (50\~80)** | "나트륨 조절이 필요합니다" |
| **User D (저탄고지)** | 지방 과다, 탄수화물 결핍 | **주의/위험** | 극단적 영양 불균형 감지 |
| **User F (벌크업)** | 과식, 초고단백 | **주의** | 클린 식단이어도 과식은 감점 요인 |

##  파일 구조

  * `texct_scoreing.py`: 데이터 로드, 전처리, 모델 학습, 점수 산출 로직이 포함된 메인 스크립트
  * `diabetes_risk_model_v5_xgb.pkl`: 학습된 모델 파일 (스크립트 실행 시 생성됨)
  * `.gitignore`: 불필요한 파일 제외 설정
